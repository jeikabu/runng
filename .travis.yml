language: rust
rust:
  - stable

cache:
  cargo: true
  directories:
    # Cache kcov binary created in after_success.sh
    - $HOME/kcov-build/

os:
  - linux
  - osx

# Need travis full VM otherwise kcov fails
sudo: required
addons:
  apt:
    packages:
      # To build nng
      - cmake
      - ninja-build
      # To build kcov
      - libcurl4-openssl-dev
      - libelf-dev
      - libdw-dev
      - gcc
      - binutils-dev
      - libiberty-dev

before_install:
  # Using `source` so can update PATH environment variable
  - source ./scripts/install.sh

before_script:
  - rustup component add clippy-preview

script:
  # Clippy output for bindgen.rs is massive and causes travis job to fail...
  #- cargo clippy
  - cargo build
  - cargo test "tests::"

after_success:
  - ./scripts/after_success.sh